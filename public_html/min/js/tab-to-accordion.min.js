var TabToAccordion={time:800,init:function(){TabToAccordion.current=$(".current");if(TabToAccordion.current.length>0){TabToAccordion.current.prop("setted",true);TabToAccordion.current.prop("open",true)}else{TabToAccordion.current=null}var e=$(".tab_pane").find("a:not(.close)");var g=$(".tab_pane").find(".close");var b=$("#trasporti-desktop");if(b.length==0){TabToAccordion.home=false;$.ajax({type:"GET",url:$("#trasporti-main").attr("href"),dataType:"html",success:function(k,h,j){if(k!==undefined){var i=$(k).find("#trasporti-desktop");i.css("display","none");$(".body-background").append(i)}}})}for(var d=0;d<e.length;d++){var c=$(e[d]);var a=c.parents(".tab_pane:first");c.prop("panel",a);console.log("open panel",a);c.click(TabToAccordion.accordionOpenClick);var f=$(g[d]);f.prop("panel",a);f.click(TabToAccordion.accordionCloseClick);a.prop("link",c)}TabToAccordion.pushState(true);if($(window).width()<481){TabToAccordion.mobile=true}else{TabToAccordion.mobile=false}$(window).on("oneColumn",function(){TabToAccordion.mobile=true;$("#trasporti-desktop").css("display","none");$("#trasporti-tab").css("display","block")});$(window).on("fluidGrid",function(){TabToAccordion.mobile=false;TabToAccordion.restoreTab()});$(window).on("noMobile",function(){TabToAccordion.mobile=false;TabToAccordion.restoreTab()});History.Adapter.bind(window,"statechange",function(){var h=History.getState();if(TabToAccordion.manualStateChange){TabToAccordion.restoreState(h.data)}TabToAccordion.manualStateChange=true})},restoreState:function(b){var a=$('.accordion-button>.open[href="'+b.href+'"]');if(a.length>0&&$(document).width()<481){TabToAccordion.loadPage(a)}else{window.location.href=b.href}},restoreTab:function(){console.log("While restoring, tab to accordion... ",TabToAccordion.current);if(TabToAccordion.current!=null){var a=$(this.current);a.find("a").removeAttr("style");a.find(".tab_page").removeAttr("style");a.addClass("current")}else{console.log("no current entry");$("#trasporti-desktop").css("display","block");$("#trasporti-tab").css("display","none");var b=$("#trasporti-header");var d={href:b.data("href"),};var c=History.getState();if(c.href!=d.href){History.pushState(d,b.data("title"),d.href)}}},accordionCloseClick:function(c){c.preventDefault();TabToAccordion.current=null;TabToAccordion.home=true;var b=$(this);var a=b.prop("panel");a.removeClass("current");TabToAccordion.hide(a.children(".tab_page"));a.prop("open",false)},accordionOpenClick:function(a){a.preventDefault();TabToAccordion.loadPage($(this))},loadPage:function(b){$(document.body).css("cursor","wait");b=$(b);var a;a=$(b.prop("panel"));if(!a.prop("setted")){var c=b.attr("href");$.ajax({type:"GET",url:c,dataType:"html",success:function(g,d,f){if(g!==undefined){var e=$(g).find(".tab_page");a.append(e);e.slideUp(0);a.prop("setted",true);b.prop("panel",a)}},complete:function(){TabToAccordion.changePage(a)}})}else{TabToAccordion.changePage(a)}},changePage:function(a){a=$(a);var d=$(TabToAccordion.current);if(!a.is(d)){TabToAccordion.home=false;TabToAccordion.hide(d.children(".tab_page"),function(){d.removeClass("current")});d.prop("open",false);TabToAccordion.current=a;TabToAccordion.pushState();$(".tab_controls").children(".selected").removeClass("selected");var c=$(a.prop("tabLink"));c.parent().addClass("selected");a.addClass("current");TabToAccordion.show(a.children(".tab_page"));a.prop("open",true);var b=a.data("trigger");$(".tab_right_col").find(".selected").removeClass("selected");$(b).addClass("selected")}else{if(a.prop("open")){TabToAccordion.current=null;TabToAccordion.home=true;a.children(".close").hide();TabToAccordion.hide(a.children(".tab_page"));a.removeClass("current");a.prop("open",false)}else{TabToAccordion.home=false;TabToAccordion.current=a;a.children(".close").css("display","table");TabToAccordion.show(a.children(".tab_page"));a.addClass("current");a.prop("open",true)}}$(document.body).css("cursor","auto")},pushState:function(a){TabToAccordion.manualStateChange=false;var d=$(TabToAccordion.current);var b=$(d.prop("link"));var c={href:b.attr("href"),};if(a!=undefined&&a){History.replaceState(c,d.data("title"),b.attr("href"))}else{History.pushState(c,d.data("title"),b.attr("href"))}},show:function(b,a){if(TabToAccordion.mobile){b.slideDown(TabToAccordion.time,a)}else{b.fadeIn(0,a)}},hide:function(b,a){if(TabToAccordion.mobile){b.slideUp(TabToAccordion.time,a)}else{b.fadeOut(0,a)}}};$(document).ready(TabToAccordion.init());